- name: Set up Proxmox VE
  hosts: proxmox
  become: true
  gather_facts: true
  gather_subset: ["min", "virtualization_role", "virtualization_type"]
  roles:
    - sys/proxmox

- name: Set up all guests
  hosts: guests
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution", "virtualization_type"]
  roles:
    - sys/base

- name: Set up Pi-hole instance
  hosts: pihole
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution"]
  vars:
    php_enable: true
  roles:
    - inf/apache_php
    - app/pihole

- name: Set up storage server
  hosts: storage
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution"]
  roles:
    - inf/cockpit
    - app/file_shares
    - app/jellyfin

- name: Set up Apache + PHP + Postgres
  hosts: c-lapp
  become: true
  gather_facts: true
  gather_subset: ["min"]
  roles:
    - inf/apache_php
    - inf/postgresql
    - app/pages

- name: Set up containers
  hosts: v-containers
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution", "virtualization_type"]
  roles:
    - app/containers
    - inf/tailscale
