---
- name: Set up Proxmox VE
  hosts: proxmox
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_role
    - virtualization_type
  roles:
    - system_pve

- name: Set up all guests
  hosts: guests
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  roles:
    - system_el

- name: Set up AdGuard Home
  hosts: adguard
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
  roles:
    - adguard_home

- name: Set up PostgreSQL
  hosts: postgres
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
  roles:
    - postgresql

- name: Set up containers
  hosts: v-containers
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  roles:
    - containers_web
    - tailscale

- name: Set up storage server
  hosts: storage
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  roles:
    - containers_storage
    - samba_share
