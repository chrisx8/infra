- name: Set up Proxmox VE
  hosts: proxmox
  become: true
  gather_facts: true
  gather_subset: ['min', 'virtualization_role', 'virtualization_type']
  roles:
    - sys/proxmox

- name: Set up all guests
  hosts: guests
  become: true
  gather_facts: true
  gather_subset: ['!min', 'distribution', 'virtualization_type']
  roles:
    - sys/base

- name: Set up Pi-hole instance
  hosts: c-pihole
  become: true
  gather_facts: true
  gather_subset: ['!min', 'distribution']
  roles:
    - inf/apache_php
    - app/pihole

- name: Set up storage server
  hosts: storage
  become: true
  gather_facts: true
  gather_subset: ['!min', 'distribution']
  roles:
    - inf/cockpit
    - app/file_shares
    - app/jellyfin

- name: Set up Apache + PHP + Postgres
  hosts: c-lapp
  become: true
  gather_facts: true
  gather_subset: ['min']
  vars:
    php_composer: true
  roles:
    - inf/apache_php
    - inf/postgresql
    - app/nextcloud
    - app/pages

- name: Set up containers
  hosts: v-containers
  become: true
  gather_facts: true
  gather_subset: ['!min', 'distribution', 'virtualization_type']
  roles:
    - app/containers
    - inf/tailscale
