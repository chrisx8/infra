---
- name: Set up Proxmox VE
  hosts: proxmox
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_role
    - virtualization_type
  roles:
    - cx_base_pve

- name: Set up all guests
  hosts: guests
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  vars_prompt:
    - name: cx_tailscale_auth_key
      prompt: |-
        ###### Tailscale - ACTION REQUIRED ######
        Generate a pre-authorized Tailscale auth key at https://login.tailscale.com/admin/settings/keys
        Enter Tailscale auth key
  roles:
    - cx_base_el
    - cx_tailscale

- name: Set up AdGuard Home
  hosts: adguard
  become: true
  roles:
    - cx_adguard_home

- name: Set up containers
  hosts: v-containers
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  roles:
    - cx_postgresql
    - containers_web

- name: Set up storage server
  hosts: storage
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  roles:
    - cx_samba
    - containers_storage
