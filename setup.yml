- name: Set up Proxmox VE
  hosts: proxmox
  become: true
  gather_facts: true
  gather_subset: ["min", "virtualization_role", "virtualization_type"]
  roles:
    - system_pve

- name: Set up all guests
  hosts: guests
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution", "virtualization_type"]
  roles:
    - system_el

- name: Set up Pi-hole instance
  hosts: pihole
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution"]
  vars:
    php_enable: true
  roles:
    - apache_php
    - pihole

- name: Set up storage server
  hosts: storage
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution", "virtualization_type"]
  roles:
    - cockpit
    - samba_share
    - apache_php
    - containers_storage

- name: Set up Apache + PHP + Postgres
  hosts: c-lapp
  become: true
  gather_facts: true
  gather_subset: ["min"]
  roles:
    - apache_php
    - postgresql
    - static_sites

- name: Set up containers
  hosts: v-containers
  become: true
  gather_facts: true
  gather_subset: ["!min", "distribution", "virtualization_type"]
  roles:
    - containers_web
    - inf/tailscale
