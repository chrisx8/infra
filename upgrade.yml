---
- name: Upgrade proxmox
  hosts: proxmox
  become: true
  tasks:
    - name: Upgrade
      ansible.builtin.import_role:
        name: cx_base_pve
        tasks_from: upgrade.yml
    - name: Install ssl cert for PVE
      ansible.builtin.import_role:
        name: cx_base_pve
        tasks_from: ssl_cert.yml

- name: Upgrade guests
  hosts: guests
  become: true
  tasks:
    - name: Upgrade
      ansible.builtin.import_role:
        name: cx_base_el
        tasks_from: upgrade.yml

- name: Upgrade AdGuard Home
  hosts: adguard
  become: true
  roles:
    - cx_adguard_home

- name: Upgrade containers
  hosts: v-containers
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  roles:
    - containers_web
  pre_tasks:
    - name: Install ssl cert for PostgreSQL
      ansible.builtin.import_role:
        name: cx_postgresql
        tasks_from: sslcert.yml

- name: Upgrade storage
  hosts: storage
  become: true
  gather_facts: true
  gather_subset:
    - "!min"
    - distribution
    - virtualization_type
  roles:
    - containers_storage
