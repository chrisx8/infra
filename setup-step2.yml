# Set up web applications

- name: Set up Postgres databases
  hosts: db-postgres
  gather_facts: false
  become: true
  become_user: postgres
  tasks:
    - name: Create Postgres databases for container apps
      ansible.builtin.import_role:
        name: app/containers
        tasks_from: create_postgres_db.yml
    - name: Create Postgres database for Firefly III
      ansible.builtin.import_role:
        name: app/firefly-iii
        tasks_from: create_postgres_db.yml
    - name: Create Postgres database for Nextcloud
      ansible.builtin.import_role:
        name: app/nextcloud
        tasks_from: create_postgres_db.yml

- name: Set up containers
  hosts: web-docker
  become: true
  roles:
    - sys/base_vm
    - sys/base
    - sys/docker
    - app/containers

- name: Set up Apache + PHP
  hosts: web-php
  become: true
  roles:
    - sys/base
    - inf/apache_php
    - app/firefly-iii
    - app/launcher
    - app/nextcloud
