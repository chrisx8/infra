- name: Install unzip
  apt:
    name: unzip
    state: latest

- name: Create /var/www/html
  file:
    path: /var/www/html
    state: directory
- name: Download latest Homer release from GitHub
  shell: curl -s https://api.github.com/repos/bastienwirtz/homer/releases/latest |
         grep 'homer\.zip' | cut -d '"' -f 4 | tail -n1 |
         xargs curl -L -o /var/www/html/homer.zip
- name: Extract Homer
  shell:
    chdir: /var/www/html
    cmd: unzip -o -d . homer.zip || true
- name: Remove Homer zip
  file:
    path: /var/www/html/homer.zip
    state: absent

- name: Remove Homer default assets
  shell:
    chdir: /var/www/html
    cmd: rm -rf assets/*.dist* assets/icons assets/tools logo.png
- name: Install Homer assets
  copy:
    src: homer/
    dest: /var/www/html/
