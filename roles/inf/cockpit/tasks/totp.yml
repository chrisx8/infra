- name: Install TOTP PAM module
  ansible.builtin.apt:
    name: libpam-google-authenticator
    state: present

- name: Require TOTP PAM for Cockpit
  ansible.builtin.lineinfile:
    path: /etc/pam.d/cockpit
    regexp: "pam_google_authenticator\\.so"
    line: "auth required pam_google_authenticator.so nullok"
- name: TOTP setup reminder
  ansible.builtin.pause:
    prompt: "*** TOTP Setup ***\n
      Don't forget to set up TOTP for Cockpit users! To set up, run
      `google-authenticator` as the Cockpit user.\n
      Press Enter to continue"
