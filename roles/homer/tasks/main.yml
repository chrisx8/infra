- name: Install unzip
  apt:
    name: unzip
    state: present
- name: apt clean
  command: "apt-get clean"

- name: Create /var/www/html
  file:
    path: /var/www/html
    state: directory
    owner: www-data
    group: www-data
    mode: 0755
- name: Get latest Homer version number from GitHub
  uri:
    url: https://api.github.com/repos/bastienwirtz/homer/releases/latest
    method: GET
  register: homer_info
- name: Download and extract latest Homer release from GitHub
  unarchive:
    src: "https://github.com/bastienwirtz/homer/releases/download/{{ item }}/homer.zip"
    dest: /var/www/html
    remote_src: yes
  with_items:
    "{{ homer_info['json']['tag_name'] }}"

- name: Delete Homer default assets
  file:
    path: /var/www/html/assets
    state: absent
- name: Delete Homer default logo
  file:
    path: /var/www/html/logo.png
    state: absent

- name: Install Homer assets
  copy:
    src: .
    dest: /var/www/html/
    mode: 0644
- name: Fix Homer assets directory permisison
  file:
    path: /var/www/html/assets
    mode: 0755

- name: Set up Apache
  import_tasks: apache_setup.yml
