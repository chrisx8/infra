- name: Configure ssl_cert_file
  lineinfile:
    path: /etc/postgresql/14/main/postgresql.conf
    line: "ssl_cert_file = '/etc/ssl/private/arb.fullchain.pem'"
    regex: "^#?ssl_cert_file ="
- name: Configure ssl_key_file
  lineinfile:
    path: /etc/postgresql/14/main/postgresql.conf
    line: "ssl_key_file = '/etc/ssl/private/arb.privkey.pem'"
    regex: "^#?ssl_key_file ="
- name: Configure ssl_min_protocol_version
  lineinfile: 
    path: /etc/postgresql/14/main/postgresql.conf
    line: "ssl_min_protocol_version = 'TLSv1.2'"
    regex: "^#?ssl_min_protocol_version ="
- name: Configure listen_addresses
  lineinfile:
    path: /etc/postgresql/14/main/postgresql.conf
    line: "listen_addresses = '*'"
    regex: "^#?listen_addresses ="
- name: Allow access from local network
  lineinfile:
    path: /etc/postgresql/14/main/pg_hba.conf
    line: "host    all             all             10.69.0.0/24            scram-sha-256"
    regex: "10\\.69\\.0\\.0\/24"
- name: Restart postgresql
  systemd:
    name: postgresql.service
    state: restarted
