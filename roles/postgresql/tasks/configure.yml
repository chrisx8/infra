---
- name: Configure PostgreSQL server
  ansible.builtin.blockinfile:
    path: /var/lib/pgsql/14/data/postgresql.conf
    mode: "0600"
    block: |
      listen_addresses = '*'
      ssl = on
      ssl_cert_file = '/var/lib/pgsql/ssl/fullchain.pem'
      ssl_key_file = '/var/lib/pgsql/ssl/privkey.pem'
      ssl_min_protocol_version = 'TLSv1.2'
  notify:
    - Restart postgresql

- name: Configure PostgreSQL access policy
  ansible.builtin.blockinfile:
    path: /var/lib/pgsql/14/data/pg_hba.conf
    mode: "0600"
    block: |
      # TYPE DATABASE USER ADDRESS METHOD
      hostssl  all  all  10.69.0.0/24  scram-sha-256
