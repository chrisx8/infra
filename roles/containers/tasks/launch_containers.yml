- name: Create containers directory
  file:
    path: ~/containers
    state: directory
    mode: 0700
- name: Create Nginx logs directory
  file:
    path: ~/log/nginx
    state: directory
    mode: 0700

- name: Install docker-compose.yml
  copy:
    src: docker-compose.yml
    dest: ~/containers/docker-compose.yml
    mode: 0644

- name: Start containers (docker-compose)
  command:
    chdir: ~/containers
    cmd: "docker compose up -d --build --remove-orphans"
  changed_when: yes

- name: Change owner of changedetetion.io data volume
  file:
    path: /var/lib/docker/volumes/containers_changedetection_data/_data
    state: directory
    recurse: yes
    owner: nobody
    group: nogroup

- name: Change owner of vaultwarden data volume
  file:
    path: /var/lib/docker/volumes/containers_vaultwarden_data/_data
    state: directory
    recurse: yes
    owner: nobody
    group: nogroup
