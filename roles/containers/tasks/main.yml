- name: Load version info vars
  include_vars: versions.yml

- name: Switch SSH to port 2201
  lineinfile:
    dest: "/etc/ssh/sshd_config"
    regex: "^Port "
    line: "Port 2201"
- name: Restart sshd
  systemd:
    name: sshd
    state: restarted
- name: Install Docker
  import_tasks: install_docker.yml

- name: Configure postfix
  import_role:
    name: postfix

- name: Check if postgres_init.sql exists
  stat:
    path: ~/containers/postgres_init.sql
  register: postgres_check
- name: Prep containers
  when: not postgres_check.stat.exists
  import_tasks: prep_containers.yml

- name: Launch containers
  import_tasks: launch_containers.yml

- name: Install logrotate config for Nginx
  copy:
    src: logrotate/nginx-docker
    dest: /etc/logrotate.d/
    mode: 0644
