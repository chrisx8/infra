version: '3'

services:
  postgres:
    container_name: postgres
    image: postgres:13-alpine
    env_file: ./postgres.env
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./postgres_init.sql:/docker-entrypoint-initdb.d/postgres_init.sql:ro
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  gitea:
    container_name: gitea
    image: gitea/gitea:1
    env_file: ./gitea.env
    volumes:
      - gitea_data:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - 10.69.233.11:44832:3000
      - 44822:22
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  keycloak:
    container_name: keycloak
    image: quay.io/keycloak/keycloak:15.0.2
    env_file: ./keycloak.env
    ports:
      - 10.69.233.11:53925:8080
    depends_on:
      - postgres
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  miniflux:
    container_name: miniflux
    image: miniflux/miniflux:latest
    env_file: ./miniflux.env
    ports:
      - 10.69.233.11:64643:8080
    depends_on:
      - postgres
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  vaultwarden:
    container_name: vaultwarden
    image: vaultwarden/server:latest
    env_file: ./vaultwarden.env
    user: nobody:nogroup
    ports:
      - 10.69.233.11:3012:3012
      - 10.69.233.11:8288:8288
    volumes:
      - /opt/vaultwarden-data:/data
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    restart: unless-stopped

volumes:
  gitea_data:
  postgres_data:
