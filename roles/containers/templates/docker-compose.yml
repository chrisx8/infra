version: '3'

services:
  postgres:
    container_name: postgres
    image: postgres:13-alpine
    env_file: ./postgres.env
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./postgres_init.sql:/docker-entrypoint-initdb.d/postgres_init.sql:ro
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  keycloak:
    container_name: keycloak
    image: quay.io/keycloak/keycloak-x:15.0.2
    command: "--auto-config --proxy=edge --db=postgres -Dkc.db.url.host=postgres --db-username=keycloak --db-password=$${DB_PASSWORD}"
    env_file: ./keycloak.env
    ports:
      - 10.69.233.11:53925:8080
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - /etc/hosts:/etc/hosts:ro
    depends_on:
      - postgres
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  miniflux:
    container_name: miniflux
    image: miniflux/miniflux:latest
    env_file: ./miniflux.env
    ports:
      - 10.69.233.11:64643:8080
    depends_on:
      - postgres
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  vaultwarden:
    container_name: vaultwarden
    image: vaultwarden/server:latest
    env_file: ./vaultwarden.env
    user: nobody:nogroup
    ports:
      - 10.69.233.11:3012:3012
      - 10.69.233.11:8288:8288
    volumes:
      - /opt/vaultwarden-data:/data
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    restart: unless-stopped
  wikijs:
    container_name: wikijs
    image: requarks/wiki:2
    env_file: ./wikijs.env
    ports:
      - 10.69.233.11:9454:3000
    depends_on:
      - postgres
    cap_drop:
      - all
    security_opt:
      - no-new-privileges
    restart: unless-stopped

volumes:
  postgres_data:
