- name: Create /var/www/html
  file:
    path: /var/www/html
    state: directory
    owner: www-data
    group: www-data
    mode: 0755
- name: Install dashboard
  copy:
    src: .
    dest: /var/www/html/
    owner: www-data
    group: www-data
    mode: 0644

- name: Download latest bulma.min.css
  get_url:
    url: https://unpkg.com/bulma/css/bulma.min.css
    dest: /var/www/html/assets/css/bulma.min.css
    mode: 0644  
- name: Download latest bulma-prefers-dark.min.css
  get_url:
    url: https://unpkg.com/bulma-prefers-dark/css/bulma-prefers-dark.min.css
    dest: /var/www/html/assets/css/bulma-prefers-dark.min.css
    mode: 0644

- name: Load version info vars
  include_vars: versions.yml
- name: Download and extract Font Awesome
  unarchive:
    src: "https://use.fontawesome.com/releases/v{{ item }}/fontawesome-free-{{ item }}-web.zip"
    dest: /var/www/html/assets
    remote_src: yes
    include:
      - "fontawesome-free-{{ item }}-web/css/all.min.css"
      - "fontawesome-free-{{ item }}-web/webfonts/fa-brands-400.woff2"
      - "fontawesome-free-{{ item }}-web/webfonts/fa-solid-900.woff2"
      - "fontawesome-free-{{ item }}-web/LICENSE.txt"
  with_items:
    - "{{ FONT_AWESOME_VERSION }}"

- name: Load main config
  include_vars:
    file: main.yml
- block:
  - name: Load ACCESS config
    include_vars:
      file: access.yml
  - name: Generate ACCESS HTML
    template:
      src: dashboard.html.j2
      dest: /var/www/html/index.html
      owner: www-data
      group: www-data
      mode: 0644

- block:
  - name: Load Downloads config
    include_vars:
      file: downloads.yml
  - name: Generate Downloads HTML
    template:
      src: dashboard.html.j2
      dest: /var/www/html/downloads.html
      owner: www-data
      group: www-data
      mode: 0644

- block:
  - name: Load Admin Center config
    include_vars:
      file: admin-center.yml
  - name: Generate Admin Center HTML
    template:
      src: dashboard.html.j2
      dest: /var/www/html/admin/index.html
      owner: www-data
      group: www-data
      mode: 0644

- import_tasks: apache_setup.yml
