- name: Install software-properties-common
  apt:
    name: software-properties-common
    state: latest

- name: Add PPA for PHP
  apt_repository:
    repo: ppa:ondrej/php

- name: Install LAMP stack
  apt:
    name: [apache2, libapache2-mod-auth-openidc, libapache2-mod-fcgid, mariadb-server, 
           python3-mysqldb, php8.0-fpm, php8.0-mysql]
    state: latest

- name: Remove software-properties-common
  apt:
    name: software-properties-common
    state: absent
    autoremove: yes
    purge: yes

- name: apt clean
  command: "apt-get clean"

- name: Copy Composer install script
  template:
    src: composer-install.sh
    dest: ~/composer-install.sh
    mode: 0755
- name: Install Composer
  shell:
    chdir: "~"
    cmd: "~/composer-install.sh"
