---
- name: Remove unneeded packages
  ansible.builtin.dnf:
    name:
      - cloud-init
      - command-not-found
      - open-iscsi
      - open-vm-tools
      - plymouth
      - postfix
      - telnet
    state: absent

- name: Install epel-release repo
  ansible.builtin.dnf:
    name: epel-release
    state: present
  when: ansible_facts.distribution != 'Fedora'

- name: Install standard packages
  ansible.builtin.dnf:
    name:
      - bind-utils
      - cronie
      - curl
      - htop
      - psmisc
      - vim
      - tar
      - unzip
      - wget
    state: present

- name: Set hostname
  ansible.builtin.hostname:
    name: "{{ ansible_host }}"
    use: systemd

- name: Set timezone
  community.general.timezone:
    name: "{{ cx_base_el_timezone }}"
    hwclock: UTC

- name: Set up passwordless sudo for wheel group
  ansible.builtin.blockinfile:
    block: "%wheel ALL=(ALL) NOPASSWD:ALL"
    path: /etc/sudoers
    state: present

- name: Disable systemd coredump
  ansible.builtin.lineinfile:
    dest: /etc/systemd/coredump.conf
    regex: Storage=
    line: Storage=none

- name: Limit systemd-journald
  ansible.builtin.lineinfile:
    dest: /etc/systemd/journald.conf
    regex: SystemMaxUse=
    line: SystemMaxUse=10M

- name: Set default text editor to vim
  ansible.builtin.lineinfile:
    dest: /etc/environment
    regex: ^EDITOR=
    line: EDITOR=vim

- name: Copy system vimrc
  ansible.builtin.copy:
    src: vimrc
    dest: /etc/vimrc.local
    mode: "0644"
