- name: Create self-signed cert dir
  ansible.builtin.file:
    path: /etc/ssl/self
    state: directory
    owner: root
    group: root
    mode: 0700
- name: Generate private key and CSR
  ansible.builtin.command:
    # yamllint disable-line rule:line-length
    cmd: "openssl req -new -nodes -sha256 -newkey rsa:4096 -out csr.pem -keyout key.pem -subj '/CN={{ inventory_hostname }}'"
    chdir: /etc/ssl/self
  changed_when: true
- name: Generate self-signed cert
  ansible.builtin.command:
    cmd: "openssl x509 -req -in csr.pem -days 365 -signkey key.pem -out cert.pem"
    chdir: /etc/ssl/self
  changed_when: true
