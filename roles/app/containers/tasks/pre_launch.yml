- name: Create containers directory
  ansible.builtin.file:
    path: ~/containers
    state: directory
    mode: 0700
  register: containers_dir
- name: Create Nginx logs directory
  ansible.builtin.file:
    path: ~/log/nginx
    state: directory
    mode: 0700

- name: Remove existing containers
  containers.podman.podman_container:
    name: "{{ item.name }}"
    state: absent
  loop: "{{ container_specs }}"

- name: Install Gitea env file
  ansible.builtin.template:
    src: gitea.env.j2
    dest: ~/containers/gitea.env
    mode: 0640
- name: Install Keycloak env file
  ansible.builtin.template:
    src: keycloak.env.j2
    dest: ~/containers/keycloak.env
    mode: 0640
- name: Install Miniflux env file
  ansible.builtin.template:
    src: miniflux.env.j2
    dest: ~/containers/miniflux.env
    mode: 0640
- name: Install Vaultwarden env file
  ansible.builtin.template:
    src: vaultwarden.env.j2
    dest: ~/containers/vaultwarden.env
    mode: 0640

- name: Install Gitea templates
  ansible.builtin.copy:
    src: gitea
    dest: ~/containers
    mode: 0644
- name: Install Nginx files
  ansible.builtin.copy:
    src: nginx
    dest: ~/containers
    mode: 0644
