- name: Verify system
  ansible.builtin.assert:
    that:
      - ansible_facts.distribution_major_version|int >= 8
      - ansible_facts.os_family == 'RedHat'
      - ansible_facts.virtualization_type == 'kvm'

- name: Load secret vars
  ansible.builtin.include_vars: secrets.yml

- name: Install Podman
  ansible.builtin.dnf:
    name: podman
    state: present

- name: Install ssl certs
  ansible.builtin.include_role:
    name: inf/ssl
    tasks_from: "{{ item }}.yml"
  loop:
    - arb
    - chrisx
    - self

- name: Set up Postgres DBs
  ansible.builtin.import_tasks: postgres_db.yml
  become_user: postgres
  delegate_to: db-postgres

- name: Install container configs
  ansible.builtin.import_tasks: containers_pre.yml
- name: Launch containers
  ansible.builtin.import_tasks: containers.yml
