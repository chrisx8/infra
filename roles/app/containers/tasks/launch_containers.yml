- name: Create container network
  containers.podman.podman_network:
    name: "{{ container_network }}"
    state: present

- name: Create gitea_data volume
  containers.podman.podman_volume:
    name: gitea_data
    state: present
- name: Create vaultwarden_data volume
  containers.podman.podman_volume:
    name: vaultwarden_data
    state: present
- name: Change owner of vaultwarden data volume
  ansible.builtin.file:
    path: /var/lib/containers/storage/volumes/vaultwarden_data/_data
    state: directory
    recurse: true
    owner: nobody
    group: nobody

- name: Pull container images
  containers.podman.podman_image:
    name: "{{ item.image }}"
    pull: true
    state: present
  loop: "{{ container_specs }}"
- name: Launch containers
  containers.podman.podman_container: "{{ item }}"
  loop: "{{ container_specs }}"

- name: Enable and start container systemd services
  ansible.builtin.systemd:
    name: "{{ container_systemd.container_prefix }}-{{ item.name }}"
    enabled: true
    daemon_reload: true
    state: started
  loop: "{{ container_specs }}"
