- name: Verify system
  ansible.builtin.assert:
    that:
      - ansible_facts.os_family == 'RedHat'

- name: Install Podman
  ansible.builtin.dnf:
    name: podman
    state: present

- name: Create container
  ansible.builtin.import_tasks: container.yml
- name: Install plugins
  ansible.builtin.import_tasks: plugins.yml
- name: Install SSL cert
  ansible.builtin.import_tasks: ssl_cert.yml

- name: Enable and restart Jellyfin service
  ansible.builtin.systemd:
    name: "{{ jellyfin_container.systemd_prefix }}-{{ jellyfin_container.name }}"
    enabled: true
    daemon_reload: true
    state: restarted

- name: Clean up container storage
  ansible.builtin.command: "podman system prune -af"
  changed_when: false
