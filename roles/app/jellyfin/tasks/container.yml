- name: Create config volume
  containers.podman.podman_volume:
    name: "{{ jellyfin_container.config_volume }}"
    state: present
- name: Set config volume dir
  ansible.builtin.set_fact:
    jellyfin_config_dir: "/var/lib/containers/storage/volumes/{{ jellyfin_container.config_volume }}/_data"

- name: Pull container image
  containers.podman.podman_image:
    name: "{{ jellyfin_container.image }}"
    force: true
    pull: true
    state: present

- name: Create container
  containers.podman.podman_container:
    name: "{{ jellyfin_container.name }}"
    image: "{{ jellyfin_container.image }}"
    ports:
      - "8096:8096"
      - "8920:8920"
    volumes:
      - "{{ jellyfin_container.config_volume }}:/config:Z"
      - "{{ jellyfin_container.media_path }}:/media:z"
    generate_systemd:
      container_prefix: c
      new: true
      path: /etc/systemd/system
      restart_policy: on-abnormal
    recreate: true
    rm: true
    security_opt:
      - no-new-privileges
    user: "65534:65534"
    state: present
