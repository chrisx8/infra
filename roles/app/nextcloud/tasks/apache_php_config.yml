- name: Install chrisx cert
  ansible.builtin.import_role:
    name: inf/ssl
    tasks_from: chrisx.yml

- name: Install Apache site configuration
  ansible.builtin.copy:
    src: nextcloud.conf
    dest: /etc/httpd/conf.d/nextcloud.conf
    mode: 0644
- name: Reload Apache
  ansible.builtin.systemd:
    name: httpd
    state: reloaded

- name: Set PHP memory_limit
  ansible.builtin.lineinfile:
    path: /etc/php.ini
    regexp: "^memory_limit"
    line: "memory_limit = 512M"
- name: Set PHP post_max_size
  ansible.builtin.lineinfile:
    path: /etc/php.ini
    regexp: "^post_max_size"
    line: "post_max_size = 5G"
- name: Set PHP upload_max_filesize
  ansible.builtin.lineinfile:
    path: /etc/php.ini
    regexp: "^upload_max_filesize"
    line: "upload_max_filesize = 5G"
- name: Restart php-fpm
  ansible.builtin.systemd:
    name: php-fpm
    state: restarted
