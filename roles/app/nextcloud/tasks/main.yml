- name: Install system dependencies
  ansible.builtin.apt:
    name: [imagemagick, libmagickcore-6.q16-6-extra]
    state: present
- name: Install PHP extensions
  ansible.builtin.apt:
    name: [php8.0-apcu, php8.0-bcmath, php8.0-curl, php8.0-gd, php8.0-gmp,
           php8.0-imagick, php8.0-intl, php8.0-mbstring, php8.0-pgsql,
           php8.0-xml, php8.0-zip]
    state: present
- ansible.builtin.import_tasks: apt_post.yml

- name: Install Apache site configuration
  ansible.builtin.copy:
    src: nextcloud.conf
    dest: /etc/apache2/sites-enabled/nextcloud.conf
    mode: 0644
- name: Reload Apache
  ansible.builtin.systemd:
    name: apache2
    state: reloaded

- name: Check if Nextcloud is installed
  ansible.builtin.stat:
    path: /var/www/nextcloud/config/config.php
  register: nextcloud_exist
- ansible.builtin.import_tasks: php_config.yml
- ansible.builtin.import_tasks: nc.yml
