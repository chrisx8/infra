- name: Create /var/www/launcher
  file:
    path: /var/www/launcher
    state: directory
    owner: www-data
    group: www-data
    mode: 0755
- name: Copy Launcher assets
  copy:
    src: .
    dest: /var/www/launcher/
    owner: www-data
    group: www-data
    mode: 0644

- name: Download latest bulma.min.css
  get_url:
    url: https://unpkg.com/bulma/css/bulma.min.css
    dest: /var/www/launcher/assets/css/bulma.min.css
    mode: 0644  
- name: Download latest bulma-prefers-dark.min.css
  get_url:
    url: https://unpkg.com/bulma-prefers-dark/css/bulma-prefers-dark.min.css
    dest: /var/www/launcher/assets/css/bulma-prefers-dark.min.css
    mode: 0644

- name: Load version info vars
  include_vars: versions.yml
- name: Download and extract Font Awesome
  unarchive:
    src: "https://use.fontawesome.com/releases/v{{ item }}/fontawesome-free-{{ item }}-web.zip"
    dest: /var/www/launcher/assets
    remote_src: true
    include:
      - "fontawesome-free-{{ item }}-web/css/all.min.css"
      - "fontawesome-free-{{ item }}-web/webfonts/fa-brands-400.woff2"
      - "fontawesome-free-{{ item }}-web/webfonts/fa-solid-900.woff2"
      - "fontawesome-free-{{ item }}-web/LICENSE.txt"
  with_items:
    - "{{ FONT_AWESOME_VERSION }}"

- block:
  - name: Load Launcher config
    include_vars:
      file: launcher.yml
  - name: Generate Launcher HTML
    template:
      src: launcher.html.j2
      dest: /var/www/launcher/index.html
      owner: www-data
      group: www-data
      mode: 0644

- block:
  - name: Load Admin Center config
    include_vars:
      file: admin-center.yml
  - name: Generate Admin Center HTML
    template:
      src: launcher.html.j2
      dest: /var/www/launcher/admin.html
      owner: www-data
      group: www-data
      mode: 0644
