---
- name: Create Apache dirs
  ansible.builtin.file:
    path: "{{ item }}"
    mode: "0755"
    state: directory
  loop:
    - "{{ _container_user_info.home }}/apache/log"
    - "{{ _container_user_info.home }}/apache/www"

- name: Create Apache ssl dir
  ansible.builtin.file:
    path: "{{ _container_user_info.home }}/apache/ssl/{{ ssl_domain }}"
    state: directory
    mode: "0700"
- name: Copy ssl cert for {{ ssl_domain }}
  ansible.builtin.copy:
    src: certbot.d/config/live/{{ ssl_domain }}/{{ item }}
    dest: "{{ _container_user_info.home }}/apache/ssl/{{ ssl_domain }}"
    mode: "0400"
  loop:
    - fullchain.pem
    - privkey.pem

- name: Copy Apache config
  ansible.builtin.copy:
    src: apache/{{ item }}
    dest: "{{ _container_user_info.home }}/apache"
    mode: "0640"
  loop:
    - conf.d
    - ports.conf
