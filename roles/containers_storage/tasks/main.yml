---
- name: Load secret vars
  ansible.builtin.include_vars: secrets.yml

- name: Verify requirements
  ansible.builtin.assert:
    that:
      - containers_storage_cron_ping_url is defined

- name: Create container user
  ansible.builtin.user:
    name: "{{ container_user }}"
    create_home: true
    home: /opt/podman
    state: present
  register: _container_user_info # noqa var-naming[no-role-prefix]

- name: Configure apps
  become_user: "{{ container_user }}"
  block:
    - name: Configure Apache
      ansible.builtin.import_tasks: apache.yml
    - name: Configure Jellyfin
      ansible.builtin.import_tasks: jellyfin.yml
    - name: Copy helper scripts
      ansible.builtin.import_tasks: scripts.yml

- name: Launch containers
  ansible.builtin.import_role:
    name: containers
