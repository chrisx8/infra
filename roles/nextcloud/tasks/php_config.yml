- name: Configure PHP-FPM env
  when: not nextcloud_exist.stat.exists
  lineinfile:
    path: /etc/php/8.0/fpm/pool.d/www.conf
    line: "env[HOSTNAME] = $HOSTNAME\n
          env[PATH] = /usr/local/bin:/usr/bin:/bin\n
          env[TMP] = /tmp\n
          env[TMPDIR] = /tmp\n
          env[TEMP] = /tmp\n
          "
- name: Set PHP-FPM memory limit
  lineinfile:
    path: /etc/php/8.0/fpm/php.ini
    regexp: '^memory_limit'
    line: 'memory_limit = 512M'
- name: Set PHP-FPM max POST size
  lineinfile:
    path: /etc/php/8.0/fpm/php.ini
    regexp: '^post_max_size'
    line: 'post_max_size = 5G'
- name: Set PHP-FPM max upload size
  lineinfile:
    path: /etc/php/8.0/fpm/php.ini
    regexp: '^upload_max_filesize'
    line: 'upload_max_filesize = 5G'

- name: Restart PHP
  systemd:
    name: php8.0-fpm
    state: restarted
