- name: Install PHP extensions
  apt:
    name: [php-apcu, php-bcmath, php-curl, php-gd, php-gmp, php-imagick, php-intl, php-mbstring, php-xml, php-zip]
    state: latest
- name: apt clean
  command: "apt-get clean"

- name: Check if Nextcloud is installed
  stat:
    path: /var/www/nextcloud/index.php
  register: nextcloud_exist

- name: Configure PHP-FPM
  import_tasks: php_config.yml
- name: Configure Apache
  import_tasks: apache_config.yml
- name: Set up database
  import_tasks: db_setup.yml
- name: Install Nextcloud
  import_tasks: nc.yml
