- name: Install extra Debian packages
  ansible.builtin.apt:
    name: [vim, libsasl2-modules, lm-sensors]
    install_recommends: false
    state: present

- name: Configure OpenSSH client
  ansible.builtin.copy:
    src: ssh_config
    dest: /etc/ssh/ssh_config
    mode: 0644
- name: Configure OpenSSH server
  ansible.builtin.copy:
    src: sshd_config
    dest: /etc/ssh/sshd_config
    mode: 0644
- name: Restart OpenSSH server (sshd)
  ansible.builtin.systemd:
    name: sshd
    state: restarted
    daemon_reload: true

- name: Install vimrc
  ansible.builtin.copy:
    src: vimrc
    dest: /etc/vim/vimrc
    mode: 0644

- name: Set GRUB timeout
  ansible.builtin.lineinfile:
    path: /etc/default/grub
    regexp: "^GRUB_TIMEOUT"
    line: GRUB_TIMEOUT=2
- name: Set kernel cmdline
  ansible.builtin.lineinfile:
    path: /etc/default/grub
    regexp: "^GRUB_CMDLINE_LINUX_DEFAULT"
    line: GRUB_CMDLINE_LINUX_DEFAULT="quiet intel_iommu=on pcie_aspm=off"
- name: Update GRUB config
  ansible.builtin.command: update-grub2
  changed_when: true

- name: Reboot
  ansible.builtin.reboot:
