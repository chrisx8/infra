server {
	listen 443 ssl http2 default_server;
	server_name webhost1.tinynet.chrisx.xyz;

	include snippets/snakeoil.conf;

	add_header Referrer-Policy "no-referrer" always;
	add_header X-Content-Type-Options "nosniff" always;
	add_header X-Frame-Options "SAMEORIGIN" always;
	add_header X-Permitted-Cross-Domain-Policies "none" always;
	add_header X-Robots-Tag "none" always;
	add_header X-XSS-Protection "1; mode=block" always;

	# include /etc/nginx/snippets/oauth2internal.conf;

	root /var/www/html;

	location / {
		index index.html;
		try_files $uri $uri/ =404;
	}

	location = /logout/finish {
		return 302 https://identity.chrisx.xyz/auth/realms/vmnet/protocol/openid-connect/logout?redirect_uri=https://server.chrisx.xyz;
	}

	location ^~ /wiki {
		# include /etc/nginx/snippets/oauth2-auth.conf;
		add_header X-Frame-Options "";
		index index.php;
		try_files $uri $uri/ =404;

		location ~ /wiki/(data/|conf/|bin/|inc/) {
			internal;
		}

		location ~ \.php(?:$|/) {
			# include /etc/nginx/snippets/oauth2-auth.conf;
			fastcgi_split_path_info ^(.+\.php)(/.+)$;
			fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
			fastcgi_param PATH_INFO $fastcgi_path_info;
			fastcgi_param HTTPS on;
			include fastcgi_params;
			fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
		}
	}

	location ~ /\.(?!well-known).* {
		internal;
	}
}
